<section class="section reservation-section">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <div class="card reservation-card">
          <div class="card-body p-4">
            <h4 class="card-title text-center mb-4">Make a New Reservation</h4>
            <form (ngSubmit)="onSearch()" #filterForm="ngForm">
              <div class="row mb-3">
                <div class="col-md-6">
                  <label class="form-label text-muted small">Reservation Date</label>
                  <input type="date" class="form-control" name="date" [(ngModel)]="filter.date" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label text-muted small">Kat</label>
                  <select class="form-select" name="floorId" [(ngModel)]="filter.floorId" required>
                    <option [value]="1">1</option>
                    <option [value]="2">2</option>
                    <option [value]="3">3</option>
                  </select>
                </div>
              </div>
              <div class="row mb-4">
                <div class="col-md-6">
                  <label class="form-label text-muted small">Start Time</label>
                  <input type="time" class="form-control" name="startTime" [(ngModel)]="filter.startTime" required>
                </div>
                <div class="col-md-6">
                  <label class="form-label text-muted small">End Time</label>
                  <input type="time" class="form-control" name="endTime" [(ngModel)]="filter.endTime" required>
                </div>
              </div>
              <button type="submit" class="btn btn-success w-100 text-uppercase fw-bold" [disabled]="!filterForm.form.valid">
                CHECK AVAILABILITY
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="reservation-notice" *ngIf="lastNotificationType">
      <div
        class="toast align-items-center show"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
        [ngClass]="{'bg-success text-white': lastNotificationType === 'success', 'bg-warning text-dark': lastNotificationType === 'warning'}"
      >
        <div class="d-flex">
          <div class="toast-body">
            <div class="fw-semibold">{{ lastSuccessMessage || lastErrorMessage }}</div>
            <div *ngIf="lastErrorReason" class="small mt-2">Ceza nedeni: {{ lastErrorReason }}</div>
          </div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" aria-label="Close" (click)="lastNotificationType = ''; lastErrorMessage = ''; lastSuccessMessage = ''; lastErrorReason = '';"></button>
        </div>
      </div>
    </div>

    <div *ngIf="tables.length > 0" class="mt-5">
      <h5 class="mb-3">Masalar</h5>
      <div class="d-flex flex-wrap gap-3">
        <div *ngFor="let table of tables"
             class="table-box"
             [ngClass]="{'available': isTableAvailable(table), 'occupied': !isTableAvailable(table)}"
             (click)="onTableSelect(table)">
          {{ table.tableNumber }}
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Confirmation Modal -->
<div class="modal-overlay" *ngIf="showConfirmationModal" style="z-index: 9999; display: flex;">
  <div class="modal-card">
    <div class="modal-header">
      <h5>Rezervasyon Onayı</h5>
      <button type="button" class="btn-close" (click)="cancelReservation()"></button>
    </div>
    <div class="modal-body">
      <p><strong>Masa {{ selectedTable?.tableNumber }}</strong> için rezervasyon yapmak istiyor musunuz?</p>
      <div class="mt-3 p-3 bg-light rounded">
        <div class="d-flex justify-content-between mb-2">
          <span class="text-muted">Tarih:</span>
          <span class="fw-bold">{{ filter.date | date:'dd.MM.yyyy' }}</span>
        </div>
        <div class="d-flex justify-content-between">
          <span class="text-muted">Saat:</span>
          <span class="fw-bold">{{ filter.startTime }} - {{ filter.endTime }}</span>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="cancelReservation()" [disabled]="isSubmitting">İptal</button>
      <button class="btn btn-primary" (click)="confirmReservation()" [disabled]="isSubmitting">
        {{ isSubmitting ? 'İşleniyor...' : 'Onayla' }}
      </button>
    </div>
  </div>
</div>


